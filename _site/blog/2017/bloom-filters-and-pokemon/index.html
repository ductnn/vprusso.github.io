<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="msvalidate.01" content="5E7827CBC3E6F12865C285B3020A9C95" />

  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/blog/2017/bloom-filters-and-pokemon/">
  <link rel="alternate" type="application/rss+xml" title="Vincent Russo" href="http://localhost:4000/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Vincent Russo</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/blog/">Blog</a>
          
        
          
        
          
          <a class="page-link" href="/cv/">Resume/CV</a>
          
        
          
        
          
          <a class="page-link" href="/">Home</a>
          
        
          
        
          
          <a class="page-link" href="/music/">Music</a>
          
        
          
          <a class="page-link" href="/projects/">Projects</a>
          
        
          
          <a class="page-link" href="/publications/">Publications</a>
          
        
          
        
          
        
          
          <a class="page-link" href="/teaching/">Teaching</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

    <header class="post-header">
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59145213-1', 'auto');
  ga('send', 'pageview');

</script>
        <h1 class="post-title">Bloom Filters and Pokemon</h1>
        <p class="post-meta">Sep 30, 2017</p>
    </header>

    <article class="post-content">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7213376997288299"
     data-ad-slot="4540332365"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
        <p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/r55QjjN.png" alt="Professor Oak on Bloom filters." />
        </figure>
    </center>
</p>

<p>In this post, we will briefly go over the probabilistic data structure referred to as a <em>Bloom filter</em>. We’ll be using Pokemon to help us in understanding the general concept of how to make use of such a data structure. The <a href="https://github.com/vprusso/youtube_tutorials/blob/master/data_structures/Bloom%20Filters%20and%20Pokemon.ipynb">Jupyter notebook corresponding to this post may be found on my Github page here</a>:</p>

<p>If you prefer, there is also an accompanying video that goes along with this post here:</p>
<div style="text-align:center">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/U8Ni1yJ8ZS4" frameborder="0" allowfullscreen=""></iframe>
</div>

<h1 id="tldr">TL;DR</h1>

<blockquote>
  <p>Bloom filters: “Lightweight” version of a hash table. Both hash tables and Bloom filters support efficient insertions and lookups. Bloom filters are more space efficient than hash tables, but this comes at the cost of having “false positives” for entry lookup. That is, Bloom filters can say with certainty that an element has not been inserted (no possibility of false negatives), but may indicate an element has been inserted when it has in fact not been (false positive).</p>
</blockquote>

<h1 id="when-should-i-use-a-bloom-filter">When should I use a Bloom filter?</h1>

<blockquote>
  <p>I want a data structure that allows for fast lookups and insertions. I care about how much space the data structure uses. I don’t care if the data structure sometimes indicates an item is present when in fact it is not.”</p>
</blockquote>

<h2 id="example">Example:</h2>

<p>I run a website and want to keep track of IP addresses that are blocked. I don’t particularly care if a blocked IP address is occasionally able to access my website, but I do care if someone not on the blocked list is unable to access the site.</p>

<p><a href="https://en.wikipedia.org/wiki/Bloom_filter#Examples" title="Wikipedia Bloom filter examples.">More examples found on Wikipedia</a>.</p>

<h1 id="bloom-filter-toy-example-in-python">Bloom Filter: Toy Example in Python</h1>

<p>In order to illustrate how a Bloom filter works let’s consider a toy example. We start with a <em>bit vector</em>; a vector whose elements are $0$ or $1$. To start, we initialize the bit vector to all zeros. For the purposes of this toy example, we will restrict our attention to a bit vector of size $20$.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">bit_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span>
<span class="k">print</span><span class="p">(</span><span class="n">bit_vector</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
</code></pre>
</div>

<p>The next ingredient we require is the use of a couple <em>hash functions</em>, that is, a function that maps data of arbitrary size to data of a fixed size. The types of hash functions used in Bloom filters are generally not of the “cryptographic variety”, for example, one usually wouldn’t use something like <a href="https://en.wikipedia.org/wiki/MD5" title="Wikipedia MD5.">MD5</a>. Non-cryptographic hash functions like <a href="https://en.wikipedia.org/wiki/MurmurHash" title="Wikipedia Murmur hashes.">Murmur</a> and <a href="https://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function" title="Wikipedia FNV hashes.">FNV</a> are mostly used, primarily for their speed over most cryptographic hash functions.</p>

<p>There is a nice module in Python called <a href="https://pypi.python.org/pypi/pyhash" title="Pyhash Python module."><code class="highlighter-rouge">pyhash</code></a> that consists solely of non-cryptographic hashes.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pyhash</span>
</code></pre>
</div>

<p>Let’s combine the <em>bit vector</em> and <em>non-cryptographic hash functions</em> to put together a toy example of a Bloom filter. In our example, let’s say we’re using our Bloom filter as a Pokedex; a device to keep track of the Pokemon we have caught. Each time we catch a Pokemon, we update our Pokedex by running the name of the Pokemon through two hash functions. The output of the hashes indicates which bits to flip in our bit vector.</p>

<p>Hashing the strings “Pikachu” and “Charmander” using the FNV hash algorithm mod 20 (since 20 is the size of our bit vector in this example) results in 13 and 5. Likewise, hashing the same strings using the Murmur hashing algorithm mod 20 results in 10 and 9, respectively.</p>

<p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/yq1pefN.png" alt="Feeding the Pokemon strings into the hash functions." />
        </figure>
    </center>
</p>

<p>We use the outputs of the above hash algorithms to flip the bits located at the respective indices. For instance:</p>

<p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/7j7hK5H.png" alt="Resulting bit vector once we've hashed the Pokemon strings." />
        </figure>
    </center>
</p>

<p>The following Python code achieves what we described above:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Define FNV and Murmur hash functions from Pyhash.</span>
<span class="n">fnv_hasher</span> <span class="o">=</span> <span class="n">pyhash</span><span class="o">.</span><span class="n">fnv1_32</span><span class="p">()</span>
<span class="n">murmur_hasher</span> <span class="o">=</span> <span class="n">pyhash</span><span class="o">.</span><span class="n">murmur3_32</span><span class="p">()</span>

<span class="c"># Calculate output of FNV and Murmur hash for Pikachu and Charmander.</span>
<span class="n">fnv_hash_pikachu</span> <span class="o">=</span> <span class="n">fnv_hasher</span><span class="p">(</span><span class="s">"Pikachu"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
<span class="n">murmur_hash_pikachu</span> <span class="o">=</span> <span class="n">murmur_hasher</span><span class="p">(</span><span class="s">"Pikachu"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>

<span class="n">fnv_hash_charmander</span> <span class="o">=</span> <span class="n">fnv_hasher</span><span class="p">(</span><span class="s">"Charmander"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
<span class="n">murmur_hash_charmander</span> <span class="o">=</span> <span class="n">murmur_hasher</span><span class="p">(</span><span class="s">"Charmander"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>

<span class="c"># Print the output of FNV and Murmur hashes.</span>
<span class="k">print</span><span class="p">(</span><span class="s">"FNV hash output for Pikachu: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fnv_hash_pikachu</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Murmur hash output for Pikachu: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">murmur_hash_pikachu</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"FNV hash output for Charmander: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fnv_hash_charmander</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Murmur hash output for Charmander: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">murmur_hash_charmander</span><span class="p">))</span>

<span class="c"># Flip the bits of bit_vector in the corresponding locations from above hashes.</span>
<span class="n">bit_vector</span><span class="p">[</span><span class="n">fnv_hash_pikachu</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bit_vector</span><span class="p">[</span><span class="n">murmur_hash_pikachu</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">bit_vector</span><span class="p">[</span><span class="n">fnv_hash_charmander</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bit_vector</span><span class="p">[</span><span class="n">murmur_hash_charmander</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="n">bit_vector</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>FNV hash output for Pikachu: 13
Murmur hash output for Pikachu: 10
FNV hash output for Charmander: 5
Murmur hash output for Charmander: 9
[0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0]
</code></pre>
</div>

<p>Walking in the tall grass, a wild Bulbasaur appears!</p>
<p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/c0mA46j.png" alt="Bulbasaur." />
        </figure>
    </center>
</p>

<p>Let’s consult our Bloom filter Pokedex to see if we’ve already captured Bulbasaur or not</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Calculate output of FNV and Murmur hash for Bulbasaur.</span>
<span class="n">fnv_hash_bulbasaur</span> <span class="o">=</span> <span class="n">fnv_hasher</span><span class="p">(</span><span class="s">"Bulbasaur"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
<span class="n">murmur_hash_bulbasaur</span> <span class="o">=</span> <span class="n">murmur_hasher</span><span class="p">(</span><span class="s">"Bulbasaur"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>

<span class="c"># Print the FNV and Murmur hashes of Bulbasaur.</span>
<span class="k">print</span><span class="p">(</span><span class="s">"FNV hash output for Bulbasaur: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fnv_hash_bulbasaur</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Murmur hash output for Bulbasaur: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">murmur_hash_bulbasaur</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>FNV hash output for Bulbasaur: 11
Murmur hash output for Bulbasaur: 8
</code></pre>
</div>

<p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/WoQqlwC.png" alt="Adding Bulbasaur to our Bloom filter." />
        </figure>
    </center>
</p>

<p>Looks like the outputs of hashing “Bulbasaur” (mod 20) result in an output of $11$ and $8$ for the FNV and Murmur hashes respectively. Consulting our Bloom filter bit vector, we check whether the bits are flipped “on” or “off” at these indices:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">bit_vector</span><span class="p">[</span><span class="n">fnv_hash_bulbasaur</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">bit_vector</span><span class="p">[</span><span class="n">murmur_hash_bulbasaur</span><span class="p">])</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>0
0
</code></pre>
</div>

<p>Since the entries for both of the hash functions for Bulbasaur result in $0$, Bulbasaur is not in our Pokedex. Let’s capture Bulbasaur and appropriately modify out Bloom filter Pokedex to reflect this.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Flip the bits in the Bloom filter to indicate that we now have captured Bulbasaur.</span>
<span class="n">bit_vector</span><span class="p">[</span><span class="n">fnv_hash_bulbasaur</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bit_vector</span><span class="p">[</span><span class="n">murmur_hash_bulbasaur</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">bit_vector</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>[0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0]
</code></pre>
</div>

<p>BULBASAUR was caught!</p>

<h1 id="how-big-does-our-bloom-filter-need-to-be">How big does our Bloom filter need to be?</h1>

<p>In our toy example, the size of the Bloom filter consists of 20 entries. For our Pokedexing needs, the length of the filter is most likely too small to be useful. To see why, let’s assume we’ve caught 150 of the 151 of the Pokemon.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># 150 of the 151 Pokemon (excluding Pidgey)</span>
<span class="n">caught_pokemon</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Bulbasaur"</span><span class="p">,</span> <span class="s">"Ivysaur"</span><span class="p">,</span> <span class="s">"Venusaur"</span><span class="p">,</span> <span class="s">"Charmander"</span><span class="p">,</span> <span class="s">"Charmeleon"</span><span class="p">,</span> <span class="s">"Charizard"</span><span class="p">,</span> 
                  <span class="s">"Squirtle"</span><span class="p">,</span> <span class="s">"Wartortle"</span><span class="p">,</span> <span class="s">"Blastoise"</span><span class="p">,</span> <span class="s">"Caterpie"</span><span class="p">,</span> <span class="s">"Metapod"</span><span class="p">,</span> <span class="s">"Butterfree"</span><span class="p">,</span> <span class="s">"Weedle"</span><span class="p">,</span> 
                  <span class="s">"Kakuna"</span><span class="p">,</span> <span class="s">"Beedrill"</span><span class="p">,</span> <span class="s">"Pidgeotto"</span><span class="p">,</span> <span class="s">"Pidgeot"</span><span class="p">,</span> <span class="s">"Rattata"</span><span class="p">,</span> <span class="s">"Raticate"</span><span class="p">,</span> <span class="s">"Spearow"</span><span class="p">,</span> <span class="s">"Fearow"</span><span class="p">,</span> 
                  <span class="s">"Ekans"</span><span class="p">,</span> <span class="s">"Arbok"</span><span class="p">,</span> <span class="s">"Pikachu"</span><span class="p">,</span> <span class="s">"Raichu"</span><span class="p">,</span> <span class="s">"Sandshrew"</span><span class="p">,</span> <span class="s">"Sandslash"</span><span class="p">,</span> <span class="s">"Nidoran (female)"</span><span class="p">,</span> <span class="s">"Nidorina"</span><span class="p">,</span>
                  <span class="s">"Nidoqueen"</span><span class="p">,</span> <span class="s">"Nidoran (male)"</span><span class="p">,</span> <span class="s">"Nidorino"</span><span class="p">,</span> <span class="s">"Nidoking"</span><span class="p">,</span> <span class="s">"Clefairy"</span><span class="p">,</span> <span class="s">"Clefable"</span><span class="p">,</span> <span class="s">"Vulpix"</span><span class="p">,</span> 
                  <span class="s">"Ninetales"</span><span class="p">,</span> <span class="s">"Jigglypuff"</span><span class="p">,</span> <span class="s">"Wigglytuff"</span><span class="p">,</span> <span class="s">"Zubat"</span><span class="p">,</span> <span class="s">"Golbat"</span><span class="p">,</span> <span class="s">"Oddish"</span><span class="p">,</span> <span class="s">"Gloom"</span><span class="p">,</span> <span class="s">"Vileplume"</span><span class="p">,</span> 
                  <span class="s">"Paras"</span><span class="p">,</span> <span class="s">"Parasect"</span><span class="p">,</span> <span class="s">"Venonat"</span><span class="p">,</span> <span class="s">"Venomoth"</span><span class="p">,</span> <span class="s">"Diglet"</span><span class="p">,</span> <span class="s">"Dugtrio"</span><span class="p">,</span> <span class="s">"Meowth"</span><span class="p">,</span> <span class="s">"Persian"</span><span class="p">,</span> <span class="s">"Psyduck"</span><span class="p">,</span>
                  <span class="s">"Golduck"</span><span class="p">,</span> <span class="s">"Mankey"</span><span class="p">,</span> <span class="s">"Primeape"</span><span class="p">,</span> <span class="s">"Growlithe"</span><span class="p">,</span> <span class="s">"Arcanine"</span><span class="p">,</span> <span class="s">"Poliwag"</span><span class="p">,</span> <span class="s">"Poliwhirl"</span><span class="p">,</span> <span class="s">"Poliwrath"</span><span class="p">,</span>
                  <span class="s">"Abra"</span><span class="p">,</span> <span class="s">"Kadabra"</span><span class="p">,</span> <span class="s">"Alakazam"</span><span class="p">,</span> <span class="s">"Machop"</span><span class="p">,</span> <span class="s">"Machoke"</span><span class="p">,</span> <span class="s">"Machamp"</span><span class="p">,</span> <span class="s">"Bellsprout"</span><span class="p">,</span> <span class="s">"Weepinbell"</span><span class="p">,</span> 
                  <span class="s">"Victreebel"</span><span class="p">,</span> <span class="s">"Tentacool"</span><span class="p">,</span> <span class="s">"Tentacruel"</span><span class="p">,</span> <span class="s">"Geodude"</span><span class="p">,</span> <span class="s">"Graveler"</span><span class="p">,</span> <span class="s">"Golem"</span><span class="p">,</span> <span class="s">"Ponyta"</span><span class="p">,</span> <span class="s">"Rapidash"</span><span class="p">,</span>
                  <span class="s">"Slowpoke"</span><span class="p">,</span> <span class="s">"Slowbro"</span><span class="p">,</span> <span class="s">"Magnemite"</span><span class="p">,</span> <span class="s">"Magneton"</span><span class="p">,</span> <span class="s">"Farfetc'd"</span><span class="p">,</span> <span class="s">"Doduo"</span><span class="p">,</span> <span class="s">"Dodrio"</span><span class="p">,</span> <span class="s">"Seel"</span><span class="p">,</span>
                  <span class="s">"Dewgong"</span><span class="p">,</span> <span class="s">"Grimer"</span><span class="p">,</span> <span class="s">"Muk"</span><span class="p">,</span> <span class="s">"Shellder"</span><span class="p">,</span> <span class="s">"Cloyster"</span><span class="p">,</span> <span class="s">"Gastly"</span><span class="p">,</span> <span class="s">"Haunter"</span><span class="p">,</span> <span class="s">"Gengar"</span><span class="p">,</span> <span class="s">"Onyx"</span><span class="p">,</span>
                  <span class="s">"Drowzee"</span><span class="p">,</span> <span class="s">"Hypno"</span><span class="p">,</span> <span class="s">"Krabby"</span><span class="p">,</span> <span class="s">"Kingler"</span><span class="p">,</span> <span class="s">"Voltorb"</span><span class="p">,</span> <span class="s">"Electrode"</span><span class="p">,</span> <span class="s">"Exeggcute"</span><span class="p">,</span> <span class="s">"Exeggutor"</span><span class="p">,</span> 
                  <span class="s">"Cubone"</span><span class="p">,</span> <span class="s">"Marowak"</span><span class="p">,</span> <span class="s">"Hitmonlee"</span><span class="p">,</span> <span class="s">"Hitmonchan"</span><span class="p">,</span> <span class="s">"Lickitung"</span><span class="p">,</span> <span class="s">"Koffing"</span><span class="p">,</span> <span class="s">"Weezing"</span><span class="p">,</span> <span class="s">"Rhyhorn"</span><span class="p">,</span> 
                  <span class="s">"Rhydon"</span><span class="p">,</span> <span class="s">"Chansey"</span><span class="p">,</span> <span class="s">"Tangela"</span><span class="p">,</span> <span class="s">"Kangaskhan"</span><span class="p">,</span> <span class="s">"Horsea"</span><span class="p">,</span> <span class="s">"Seadra"</span><span class="p">,</span> <span class="s">"Goldeen"</span><span class="p">,</span> <span class="s">"Seaking"</span><span class="p">,</span> 
                  <span class="s">"Staryu"</span><span class="p">,</span> <span class="s">"Starmie"</span><span class="p">,</span> <span class="s">"Mr. Mime"</span><span class="p">,</span> <span class="s">"Scyther"</span><span class="p">,</span> <span class="s">"Jynx"</span><span class="p">,</span> <span class="s">"Electabuzz"</span><span class="p">,</span> <span class="s">"Magmar"</span><span class="p">,</span> <span class="s">"Pinsir"</span><span class="p">,</span> <span class="s">"Tauros"</span><span class="p">,</span>
                  <span class="s">"Magikarp"</span><span class="p">,</span> <span class="s">"Gyrados"</span><span class="p">,</span> <span class="s">"Lapras"</span><span class="p">,</span> <span class="s">"Ditto"</span><span class="p">,</span> <span class="s">"Eevee"</span><span class="p">,</span> <span class="s">"Vaporeon"</span><span class="p">,</span> <span class="s">"Jolteon"</span><span class="p">,</span> <span class="s">"Flareon"</span><span class="p">,</span> <span class="s">"Porygon"</span><span class="p">,</span> 
                  <span class="s">"Omanyte"</span><span class="p">,</span> <span class="s">"Omastar"</span><span class="p">,</span> <span class="s">"Kabuto"</span><span class="p">,</span> <span class="s">"Kabutops"</span><span class="p">,</span> <span class="s">"Aerodactyl"</span><span class="p">,</span> <span class="s">"Snorlax"</span><span class="p">,</span> <span class="s">"Articuno"</span><span class="p">,</span> <span class="s">"Zapdos"</span><span class="p">,</span>
                  <span class="s">"Moltres"</span><span class="p">,</span> <span class="s">"Dratini"</span><span class="p">,</span> <span class="s">"Dragonair"</span><span class="p">,</span> <span class="s">"Dragonite"</span><span class="p">,</span> <span class="s">"Mewtwo"</span><span class="p">,</span> <span class="s">"Mew"</span> <span class="p">]</span>
<span class="n">pokedex_bloom_filter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">20</span>

<span class="c"># Update the Bloom filter positions of the bit vector.</span>
<span class="k">for</span> <span class="n">pokemon</span> <span class="ow">in</span> <span class="n">caught_pokemon</span><span class="p">:</span>
    <span class="n">fnv_hash</span> <span class="o">=</span> <span class="n">fnv_hasher</span><span class="p">(</span><span class="n">pokemon</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
    <span class="n">murmur_hash</span> <span class="o">=</span> <span class="n">murmur_hasher</span><span class="p">(</span><span class="n">pokemon</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
    
    <span class="n">pokedex_bloom_filter</span><span class="p">[</span><span class="n">fnv_hash</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">pokedex_bloom_filter</span><span class="p">[</span><span class="n">murmur_hash</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
<span class="c"># The Pokedex Bloom filter.    </span>
<span class="k">print</span><span class="p">(</span><span class="n">pokedex_bloom_filter</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
</code></pre>
</div>

<p>Unbeknown to our Pokemon trainer, the last Pokemon they have yet to catch is the elusive Pidgey. As luck should have it, the trainer walks into some tall grass and a wild Pidgey appears!</p>

<p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/rZ4o322.png" alt="Pidgey" />
        </figure>
    </center>
</p>

<p>Before deciding to catch Pidgey, the trainor pulls out their Pokedex to see if they’re already caught it.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">fnv_hash_pidgey</span> <span class="o">=</span> <span class="n">fnv_hasher</span><span class="p">(</span><span class="s">"Pidgey"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
<span class="n">murmur_hash_pidgey</span> <span class="o">=</span> <span class="n">murmur_hasher</span><span class="p">(</span><span class="s">"Pidgey"</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>

<span class="k">print</span><span class="p">(</span><span class="n">pokedex_bloom_filter</span><span class="p">[</span><span class="n">fnv_hash_pidgey</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">pokedex_bloom_filter</span><span class="p">[</span><span class="n">murmur_hash_pidgey</span><span class="p">])</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1
1
</code></pre>
</div>

<p>Hmm, okay, well the entries in the Bloom filter indicate that Pidget <em>may</em> be in the Pokedex already. As mentioned before, Bloom filters will only give false positives, never false negatives. That is to say that our Pokedex will never say that Pidgey is <em>not</em> in our Pokedex if it <em>actually is</em>, but it <em>may</em> say that Pidgey is in our Pokedex, <em>even if it actually isn’t</em>.</p>

<p>This is precisely the issue we’re having at the moment. We, the audience, know that Pidgey is not in the Pokedex. Since the size of the Bloom filter is only of size $20$ and the total number of Pokemon is $151$, there will inevitably be some hash collisions leading to a situation like the one we’re encountering now.</p>

<p>Unfortunately, our Pokemon trainer decides that Pokeballs are expensive and misses their opportunity to complete their Pokedex. If Professor Oak gave our trainer a Bloom filter Pokedex with a larger number of entries, he could have reduced the probability of this unfortunate event.</p>

<p>As it happens, the rate of false positives is approximately</p>

<p><script type="math/tex">(1 - e^{-kn/m})^k</script>,</p>

<p>where $k$ is the number of hash functions used, $n$ is the number of inserted elements, and $m$ is the total number of bits, or equivalently, the length of the bit vector used for the Bloom filter.</p>

<p>More information on the above equation can be found on the Wikipedia page where there is a more <a href="https://en.wikipedia.org/wiki/Bloom_filter#Probability_of_false_positives">in-depth discussion on the probability of obtaining false positives</a>.</p>

<p>So in order to reduce the probability of collisions, we need to tweak the parameters $k$ and $m$; the number of hash functions we use and the size of the bit vector, respectively. Assuming that the hash function selects an index in the bit vector completely at random, the probability that an element in the Bloom filter is <em>not</em> set to $1$ can be calculated by</p>

<script type="math/tex; mode=display">1 - \frac{1}{m}.</script>

<p>By taking this to the $k^{th}$ power, we have the probability that the elements in the Bloom filter are <em>not</em> set to $1$ which can be calculated by</p>

<script type="math/tex; mode=display">\left( 1 - \frac{1}{m} \right)^k.</script>

<p>If we have inserted $n$ Pokemon into our Bloom filter, the probability that a certain bit in the vector is still $0$ is given by</p>

<script type="math/tex; mode=display">\left( 1 - \frac{1}{m} \right)^{kn}.</script>

<p>For instance, in our toy example, we had that the size of the bit vector for the Bloom filter was $m = 20$. We made use of $k = 2$ hash functions, FNV and Murmur. When we caught Pikachu and Charmander, this sets the value corresponding to the total number of Pokemon in our Pokedex to $n = 2$. Therefore the probability that a certain element in the bit vector is still $0$ before capturing Bulbasaur is given as</p>

<script type="math/tex; mode=display">\left( 1 - \frac{1}{20} \right)^{4} \approx 0.81450.</script>

<p>Not terrible, but as we catch more Pokemon, this number drops quite a bit. Since there are 151 Pokemon in total, it doesn’t take long for the probability of any element in the bit vector to still be $0$ to be quite low. For instance, even when we’ve caught 20 Pokemon, there’s only a $0.1285$ chance of any element in the vector still being $0$</p>

<script type="math/tex; mode=display">\left( 1 - \frac{1}{20} \right)^{40} \approx 0.1285.</script>

<p>One thing that Professor Oak must do then is to stop being so stingy and allocate more space for the Bloom filter. The other important thing to keep note of is the number of hash functions to use. If we have too many hash functions, then our Bloom filter will be quite slow, not to mention the entries in our Bloom filter will fill up faster with more hash functions in use. Alternatively, if we limit our hash functions, that increases the chance that we obtain a higher number of false positives.</p>

<p>Luckily, if we select both $m$ and $n$, the following formula is known to give us an optimal value for $k$, the number of hash functions to use</p>

<script type="math/tex; mode=display">k = (m/n)\ln(2),</script>

<p>such that the probability that the Bloom filter erroneously claims that a Pokemon is in the Pokedex is minimized. Again, that function is given as</p>

<script type="math/tex; mode=display">\left(1 - e^{-kn/m} \right)^k.</script>

<p>Using this, let’s try to come up with a Bloom filter that performs better than our toy example for the purposes of being used for a Pokedex.</p>

<p>First, (at least for Pokemon Red and Blue) the total number of Pokemon one can encounter is 151</p>

<p align="center">
    <center>
        <figure>
            <img src="https://i.imgur.com/3hj2wCz.png" alt="Set of Pokemon in the Red/Blue universe." />
        </figure>
    </center>
</p>

<p>So we can pick $n = 151$. For $m$, we can pick something quite a bit larger than that, just to be safe. Let’s set $m = 1000$ as the number of entries in our bit vector for our Bloom filter. Using these parameters, we can compute $k$.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c"># Total number of Pokemon in the Blue/Red universe.</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">151</span>
<span class="c"># Selecting parameter m to be larger than what we require. </span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="c"># Calculating the optimal k to determine how many hash functions we should use. </span>
<span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">//</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>4.15888308336
</code></pre>
</div>

<p>With these selected parameters, the probability that we encounter a false positive is</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># How likely is it with the parameters n,m, and k that we encounter a false positive?</span>
<span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">n</span><span class="o">/</span><span class="n">m</span><span class="p">))</span><span class="o">**</span><span class="n">k</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>0.04189505785699619
</code></pre>
</div>

<p>Selecting the parameters for a Bloom filter is a relatively indirect process. Are we okay with accepting this for our purposes? Perhaps for catching Pokemon, this probability is low enough to be just fine for our purposes. However, if we want to push it a bit lower, can select a different value for $m$, recompute $k$, and see if the probability is any smaller.</p>

<p>Hopefully, this post was useful to you in understanding what Bloom filters are, how they work, and optimistically achieved this in a relatively entertaining way. If you have any questions, comments, or corrections, please do not hesitate to comment below and let me know! Thanks again for taking the time to read!</p>

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7213376997288299"
     data-ad-slot="4540332365"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </article>
  
    
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'vprusso'; // required: replace example with your forum shortname
                // var disqus_developer = 1; // Comment out when the site is live
                var disqus_identifier = "/blog/2017/bloom-filters-and-pokemon/";

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

    
    <h2>Related Posts:</h2>
    <ul>
      
      
        
        
          
            <li>
              <h3>
                <a href="/blog/2018/natural-language-processing-python-5/">
                  Natural Language Processing in Python: Part 5 -- Stemming and Lemmatization
                  <small>10 Jan 2018</small>
                </a>
              </h3>
            </li>
            
            
      
        
        
          
            <li>
              <h3>
                <a href="/blog/2018/natural-language-processing-python-4/">
                  Natural Language Processing in Python: Part 4 -- WordNet
                  <small>09 Jan 2018</small>
                </a>
              </h3>
            </li>
            
            
      
        
        
          
            <li>
              <h3>
                <a href="/blog/2018/natural-language-processing-python-3/">
                  Natural Language Processing in Python: Part 3 -- Generating Word Clouds
                  <small>08 Jan 2018</small>
                </a>
              </h3>
            </li>
            
            
      
        
          

      
      
    </ul>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Vincent Russo</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Vincent Russo</li>
          <li><a href="mailto:vincentrusso1@gmail.com">vincentrusso1@gmail.com</a></li>
        </ul>
      </div>

	  <div class="footer-col  footer-col-2">
	   <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/vprusso">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">Github</span>
            </a>
          </li>
          
		  
	  
		  <li>
		    <a href="https://ca.linkedin.com/in/vrusso11" class="icon-17 linkedin" title="LinkedIn">
		      <span class="icon  icon--linkedin">
		       <svg viewBox="0 0 512 512">
			<path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"
			/>
		      </svg>
		      </span>
		      <span class="username">Linkedin</span>
		      <!--[if lt IE 9]><em>LinkedIn</em><![endif]--></a>
		  </li>
	  
	  
	  
		<li>
			<a href="https://scholar.google.ca/citations?user=dJEXPiQAAAAJ&hl=en" class="icon  icon--googlescholar" title="GoogleScholar">
			<span class="icon icon--googlescholar">
			<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16">
			<path fill="#000000" d="M14.942 12.57l-4.942-8.235v-3.335h0.5c0.275 0 0.5-0.225 0.5-0.5s-0.225-0.5-0.5-0.5h-5c-0.275 0-0.5 0.225-0.5 0.5s0.225 0.5 0.5 0.5h0.5v3.335l-4.942 8.235c-1.132 1.886-0.258 3.43 1.942 3.43h10c2.2 0 3.074-1.543 1.942-3.43zM3.766 10l3.234-5.39v-3.61h2v3.61l3.234 5.39h-8.468z"></path>
			</svg>
			</span>
			<span class="username">Google Scholar</span>
			<!--[if lt IE 9]><em>GoogleScholar</em><![endif]--></a>
		</li>
	  
	  
        </ul>
      </div>
	  
      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
      
	  	  
			<li><a href="http://stackexchange.com/users/412832/vincent-russo" class="icon-23 stackoverflow" title="StackOverflow">
			<span class="icon  icon--stackoverflow">
			<svg viewBox="0 0 512 512">
			<path d="M294.8 361.2l-122 0.1 0-26 122-0.1L294.8 361.2zM377.2 213.7L356.4 93.5l-25.7 4.5 20.9 120.2L377.2 213.7zM297.8 301.8l-121.4-11.2 -2.4 25.9 121.4 11.2L297.8 301.8zM305.8 267.8l-117.8-31.7 -6.8 25.2 117.8 31.7L305.8 267.8zM321.2 238l-105-62 -13.2 22.4 105 62L321.2 238zM346.9 219.7l-68.7-100.8 -21.5 14.7 68.7 100.8L346.9 219.7zM315.5 275.5v106.5H155.6V275.5h-20.8v126.9h201.5V275.5H315.5z"/>
			</svg>
			</span>
			<span class="username">StackOverflow</span>
			<!--[if lt IE 9]><em>StackOverflow</em><![endif]--></a></li>
		 

          
          <li>
            <a href="https://twitter.com/captainhamptons">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">Twitter</span>
            </a>
          </li>
          
		  
		  
          <li>
            <a href="https://soundcloud.com/captainhampton">
              <span class="icon  icon--soundcloud">
				<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewBox="0 0 16 16">
					<path fill="#000000" d="M13.937 8.034c-0.283 0-0.552 0.055-0.798 0.154-0.164-1.787-1.723-3.188-3.625-3.188-0.465 0-0.917 0.088-1.317 0.237-0.156 0.058-0.197 0.117-0.197 0.233v6.292c0 0.121 0.098 0.222 0.221 0.234 0.005 0.001 5.68 0.003 5.717 0.003 1.139 0 2.062-0.888 2.062-1.983s-0.924-1.983-2.063-1.983zM6.25 12h0.5l0.25-3.503-0.25-3.497h-0.5l-0.25 3.497zM4.75 12h-0.5l-0.25-2.543 0.25-2.457h0.5l0.25 2.5zM2.25 12h0.5l0.25-2-0.25-2h-0.5l-0.25 2zM0.25 11h0.5l0.25-1-0.25-1h-0.5l-0.25 1z"></path>
				</svg>
              </span>

              <span class="username">Soundcloud</span>
            </a>
          </li>
          
		  
		  
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
